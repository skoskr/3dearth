<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="style.css" />
    <title>Auroco</title>
  </head>
  <body data-route="anasayfa">
    <!-- Logo -->
    <header class="site-header">
      <div class="nav nav-left">
        <a href="index.html" aria-label="Ana sayfa">
          <img src="/img/auroco_logo.png" alt="Auroco logo" />
        </a>
        <a href="hakkimizda.html" class="link">HakkÄ±mÄ±zda</a>
        <a href="vizyon-misyon.html" class="link">Vizyon&Misyon</a>
        <a href="iletisim.html" class="link">Ä°letiÅŸim</a>
      </div>
    </header>

    <!-- Hover etiketi -->
    <div id="info" role="status" aria-live="polite"></div>

    <!-- GiriÅŸ/Ã‡Ä±kÄ±ÅŸ overlay'i -->
    <div id="page-fade" class="show" aria-hidden="true"></div>

    <!-- UI KatmanÄ±: kartlara data-group eklendi -->
    <div id="ui-layer">
      <a href="academy.html" class="group-card academy" data-group="academy">
        <div class="gc-title">Auro.Academy</div>
        <div class="gc-desc">KiÅŸisel & Kurumsal GeliÅŸim Platformu</div>
      </a>

      <a
        href="automation.html"
        class="group-card automation"
        data-group="automation"
      >
        <div class="gc-title">Auro.Automation</div>
        <div class="gc-desc">Yapay Zeka Otomasyon Platformu</div>
      </a>

      <a href="creative.html" class="group-card creative" data-group="creative">
        <div class="gc-title">Auro.Creative</div>
        <div class="gc-desc">Strateji & TasarÄ±m Ã‡Ã¶zÃ¼mleri</div>
      </a>

      <a
        href="experiences.html"
        class="group-card experiences"
        data-group="experiences"
      >
        <div class="gc-title">Auro.Experiences</div>
        <div class="gc-desc">Etkinlik & Deneyimsel Hizmetler</div>
      </a>
    </div>

    <!-- Fade aÃ§Ä±lÄ±ÅŸ -->
    <script>
      (function () {
        var fadeEl = document.getElementById("page-fade");
        if (!fadeEl) return;
        function openFade() {
          requestAnimationFrame(() => fadeEl.classList.remove("show"));
        }
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          setTimeout(openFade, 60);
        } else {
          document.addEventListener(
            "DOMContentLoaded",
            () => setTimeout(openFade, 60),
            { once: true }
          );
        }
        window.addEventListener("pageshow", () =>
          fadeEl.classList.remove("show")
        );
      })();
    </script>

    <!-- Chatbot kÃ¶kÃ¼ -->
    <div id="chatbot-root"></div>

    <!-- THREE + UI logic -->
    <script type="module">
      import * as THREE from "./js/three.module.js";
      import { OrbitControls } from "./js/OrbitControls.js";
      import { GLTFLoader } from "./js/GLTFLoader.js";
      import { initChatbot } from "./js/chatbot.js";

      /* ==== Chatbot ==== */
initChatbot(document.getElementById("chatbot-root"), {
  title: "AURORA â€¢ Auro.co",
  position: "bottom-right",
  api: "http://localhost:4001/api/chat",  // ðŸ”— backend adresi
  storageKey: "auroco_chat_history",
  welcome: "Merhaba, AURORA burada. NasÄ±l yardÄ±mcÄ± olabilirim?",
  demo: false, 
});


      /* ==== THREE.JS SAHNE ==== */
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        60,
        innerWidth / innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 0, 15);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(innerWidth, innerHeight);
      document.body.appendChild(renderer.domElement);

      scene.add(new THREE.AmbientLight(0xffffff, 0.8));
      const dir = new THREE.DirectionalLight(0xffffff, 0.5);
      dir.position.set(5, 3, 5);
      scene.add(dir);

      const EARTH_R = 5;
      const earthGeo = new THREE.SphereGeometry(EARTH_R, 64, 64);
      const earthTex = new THREE.TextureLoader().load("./textures/text.png");
      const earth = new THREE.Mesh(
        earthGeo,
        new THREE.MeshStandardMaterial({
          map: earthTex,
          roughness: 1,
          metalness: 0,
        })
      );
      scene.add(earth);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.minDistance = EARTH_R + 2;
      controls.maxDistance = EARTH_R * 4;
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;

      /* ========= GRUPLANMIÅž KONUMLAR (kÃ¼meli yerleÅŸim Ã¼retici) ========= */
      const FLOAT_OFFSET = -0.06; // kÃ¼reye gÃ¶mme/Ã§Ä±kartma
      const TARGET_HEIGHT = 2; // bina yÃ¼ksekliÄŸi normalize

      // KÃ¼me merkezleri (birim vektÃ¶r ~ ekran Ã§evresi)
      const GROUP_CENTERS = {
        experiences: new THREE.Vector3(-0.55, -0.12, 0.82), // sol-alt-Ã¶n
        creative: new THREE.Vector3(0.82, 0.08, 0.56), // saÄŸ-Ã¼st-Ã¶n
        academy: new THREE.Vector3(-0.75, 0.28, 0.6), // sol-Ã¼st-Ã¶n
        automation: new THREE.Vector3(0.58, -0.35, 0.74), // saÄŸ-alt-Ã¶n
      };

      // GruplarÄ±n sayfalarÄ±
      const GROUP_ITEMS = {
        experiences: [
          { name: "Parti ve Organizasyon", url: "parti-organizasyon.html" },
          { name: "Sosyal Medya YÃ¶netimi", url: "sosyal-medya-yonetimi.html" },
          { name: "Cast ve Hostes", url: "cast-hostes-hizmetleri.html" },
          {
            name: "Streamer & Influencer",
            url: "streamer-influencer-hizmetleri.html",
          },
        ],
        creative: [
          { name: "Stratejik DanÄ±ÅŸmanlÄ±k", url: "stratejik-danismanlik.html" },
          { name: "Dizayn", url: "dizayn.html" },
        ],
        academy: [
          { name: "Kurumsal", url: "academy-kurumsal.html" },
          { name: "KiÅŸisel", url: "academy-kisisel.html" },
        ],
        automation: [{ name: "Otomasyon", url: "automation-otomasyon.html" }],
      };

      // BaÄŸÄ±msÄ±zlar: yakÄ±nda duracaÄŸÄ± kÃ¼me
      const INDEPENDENTS = [
        {
          name: "HakkÄ±mÄ±zda",
          position: [0.15, 0.3, -4.8],
          url: "hakkimizda.html",
        },
        {
          name: "Ä°letiÅŸim",
          position: [-0.85, -0.4, -4.2],
          url: "iletisim.html",
        },
        {
          name: "Vizyon & Misyon",
          position: [0.55, -0.55, -4.5],
          url: "vizyon-misyon.html",
        },
      ];

      function tangentFrame(n) {
        const up =
          Math.abs(n.y) < 0.9
            ? new THREE.Vector3(0, 1, 0)
            : new THREE.Vector3(1, 0, 0);
        const u = new THREE.Vector3().crossVectors(up, n).normalize();
        const v = new THREE.Vector3().crossVectors(n, u).normalize();
        return { u, v };
      }
      function around(center, idx, count, angle = 0.16) {
        const n = center.clone().normalize();
        const { u, v } = tangentFrame(n);
        const t = (idx / Math.max(1, count)) * Math.PI * 2;
        const offset = u
          .clone()
          .multiplyScalar(Math.cos(t))
          .add(v.clone().multiplyScalar(Math.sin(t)))
          .multiplyScalar(Math.tan(angle));
        return n.clone().add(offset).normalize();
      }

      // continents: TEK yerde Ã¼retilmiÅŸ (grup bilgisiyle)
      const continents = (() => {
        const list = [];
        Object.entries(GROUP_ITEMS).forEach(([groupId, items]) => {
          const c = GROUP_CENTERS[groupId].clone().normalize();
          items.forEach((it, i) => {
            const dir = around(c, i, items.length, 0.13 + i * 0.015);
            const pos = dir.clone().multiplyScalar(EARTH_R + FLOAT_OFFSET);
            list.push({
              name: it.name,
              url: it.url,
              group: groupId,
              position: [pos.x, pos.y, pos.z],
            });
          });
        });
        INDEPENDENTS.forEach((it, i) => {
          const near = GROUP_CENTERS[it.near] || new THREE.Vector3(0, 0, 1);
          const dir = around(near, i + 1, 3, 0.11);
          const pos = dir.clone().multiplyScalar(EARTH_R + FLOAT_OFFSET);
          list.push({
            name: it.name,
            url: it.url,
            group: it.near,
            position: [pos.x, pos.y, pos.z],
          });
        });
        return list;
      })();

      /* ========= Raycaster / UI ========= */
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();
      const infoBox = document.getElementById("info");
      const fade = document.getElementById("page-fade");
      let previousHovered = null;
      let navigating = false;

      addEventListener("mousemove", (e) => {
        mouse.x = (e.clientX / innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / innerHeight) * 2 + 1;
      });

      function orientToNormal(obj, normal) {
        const fromUp = new THREE.Vector3(0, 1, 0);
        const q = new THREE.Quaternion().setFromUnitVectors(
          fromUp,
          normal.clone().normalize()
        );
        obj.setRotationFromQuaternion(q);
      }

      const loader = new GLTFLoader();
      const markers = [];
      const pickables = [];

      loader.load("./models/building.glb", (gltf) => {
        const src = gltf.scene;
        const box = new THREE.Box3().setFromObject(src);
        const size = new THREE.Vector3();
        box.getSize(size);
        const minY = box.min.y;

        const base = new THREE.Group();
        base.add(src);
        src.position.y -= minY;
        base.scale.setScalar(TARGET_HEIGHT / (size.y || 1));

        continents.forEach((cont) => {
          const normal = new THREE.Vector3(...cont.position).normalize();
          const pos = normal.clone().multiplyScalar(EARTH_R - 0.06);

          const group = new THREE.Group();
          group.position.copy(pos);
          group.userData = {
            name: cont.name,
            url: cont.url,
            group: cont.group,
            targetScale: 1,
            targetEmissive: 0x000000,
          };

          const model = base.clone(true);
          orientToNormal(model, normal);
          model.traverse((n) => {
            if (n.isMesh) {
              n.material = n.material.clone();
              if (!n.material.emissive)
                n.material.emissive = new THREE.Color(0x000000);
              n.userData.marker = group;
              pickables.push(n);
            }
          });
          group.add(model);

          scene.add(group);
          markers.push(group);
        });
      });

      // Kart hover â†’ ilgili gruptaki tÃ¼m binalar highlight
      document.querySelectorAll(".group-card").forEach((card) => {
        const gname = card.dataset.group;
        card.addEventListener("mouseenter", () => {
          markers.forEach((m) => {
            if (m.userData.group === gname) {
              m.userData.targetScale = 1.25;
              m.userData.targetEmissive = 0x00ffff;
            }
          });
        });
        card.addEventListener("mouseleave", () => {
          markers.forEach((m) => {
            if (m.userData.group === gname) {
              m.userData.targetScale = 1;
              m.userData.targetEmissive = 0x000000;
            }
          });
        });
      });

      // 3D tÄ±klama â†’ hovered sayfaya git
      addEventListener("click", () => {
        if (!previousHovered || navigating) return;
        navigating = true;
        const targetUrl = previousHovered.userData.url;
        window.location.assign(targetUrl);
      });

      function animate() {
        requestAnimationFrame(animate);

        if (!navigating) {
          raycaster.setFromCamera(mouse, camera);
          const hits = raycaster.intersectObjects(pickables, false);
          let hovered = null;
          if (hits.length) {
            hovered = hits[0].object.userData?.marker || null;
          }

          if (hovered && hovered !== previousHovered) {
            if (previousHovered) {
              previousHovered.userData.targetScale = 1;
              previousHovered.userData.targetEmissive = 0x000000;
            }
            hovered.userData.targetScale = 1.35;
            hovered.userData.targetEmissive = 0xffff00;
            infoBox.style.display = "block";
            infoBox.textContent = hovered.userData.name;
            previousHovered = hovered;
          } else if (!hovered) {
            if (previousHovered) {
              previousHovered.userData.targetScale = 1;
              previousHovered.userData.targetEmissive = 0x000000;
              previousHovered = null;
            }
            infoBox.style.display = "none";
          }
        }

        // smooth scale + emissive
        markers.forEach((node) => {
          const s =
            node.scale.x + (node.userData.targetScale - node.scale.x) * 0.12;
          node.scale.setScalar(s);
          const tColor = new THREE.Color(node.userData.targetEmissive);
          node.traverse((n) => {
            if (n.isMesh && n.material.emissive)
              n.material.emissive.lerp(tColor, 0.12);
          });
        });

        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>
